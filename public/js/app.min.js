firebase.initializeApp({apiKey:"AIzaSyBebYtKOqOxENgVbTfiNhWAxh4cr_Vn7Ec",authDomain:"rewards-cee1a.firebaseapp.com",databaseURL:"https://rewards-cee1a.firebaseio.com",projectId:"rewards-cee1a",storageBucket:"rewards-cee1a.appspot.com",messagingSenderId:"376174432289"});const app=angular.module("rewards",[]),emoji=new EmojiConvertor;if(app.filter("emojis",function(){return function(e){return emoji.replace_colons(e)}}),app.filter("length",function(){return function(e){return Object.keys(e||{}).length}}),"rewards.io"===window.location.hostname){const e="4201";var livereload=document.createElement("script");livereload.setAttribute("src","http://127.0.0.1:"+e+"/livereload.js"),document.head.appendChild(livereload)}app.controller("RewardsController",["$scope","$log","rewardsService",(e,r,a)=>{e.fetchRewards=(()=>{e.newReward=null,a.getAll().then(r=>{e.newReward=angular.copy(a.reward({name:"New Reward"})),e.rewards=r.data})}),e.fetchRewards()}]),app.directive("rewardCard",()=>({controller:["$log","$scope","rewardsService","configService",(e,r,a,t)=>{r.config=t,r.updating=!1,r.uploading=!1,r.reward&&!r.isNew||(r.reward=a.reward({name:"New Reward"}),r.btnMessage="New");let l=angular.copy(r.reward);r.reward.image&&a.getImageUrl(r.reward.image).then(e=>{r.imageURL=e,r.$apply()}).catch(()=>{r.imageURL=null,r.$apply()}).finally(()=>{r.imageLoaded=!0,r.$apply()}),r.save=(()=>{r.updating=!0,r.uploading=!0;let{key:e}=r;r.isNew&&(e=null),a.update(e,r.reward,r.changedProperties()).then(()=>{l=angular.copy(r.reward)}).finally(()=>{r.isNew&&"function"==typeof r.onNew&&r.onNew(),r.uploading=!1,r.updating=!1,r.cancel(),r.$apply()})}),r.edit=(()=>{r.updating=!0}),r.cancel=(()=>{r.reward=angular.copy(l),r.updating=!1}),r.remove=(()=>{a.remove(r.key).then(()=>{"function"==typeof r.onRemove&&r.onRemove()})});const n=["detail","image","name","price"];r.changedProperties=(()=>n.filter(e=>void 0===n[e]&&void 0!==r.reward[e]).filter(e=>l[e]!==r.reward[e]).filter(e=>"object"!=typeof r.reward[e]||null!==r.reward[e])),r.hasChanged=(()=>r.changedProperties().length>0),r.$watch(()=>r.reward.image,(e,a)=>{void 0===e||null===e||void 0!==a&&null!==a||r.edit(),void 0!==e&&null!==e||void 0===a||null===a||r.cancel()})}],restrict:"E",scope:{isNew:"=?",key:"=?",onNew:"&?",onRemove:"&?",reward:"=?"},templateUrl:"/templates/rewardCard.html"})),app.directive("storageImage",()=>({controller:["$log","$scope","$element","rewardsService",(e,r,a,t)=>{r.loaded=!1,r.src=r.url,r.load=(()=>{t.getImageUrl(r.url).then(e=>{r.image_url=e,r.$apply()}).catch(()=>{r.image_url=null,r.$apply()}).finally(()=>{r.loaded=!0,r.$apply()})}),r.$watch(()=>r.url,e=>{e&&"string"==typeof e&&r.load()}),r.load()}],restrict:"E",scope:{url:"="},templateUrl:"/templates/storageImage.html"})),app.directive("uploadFile",()=>({controller:["$log","$scope","$element","rewardsService",(e,r,a)=>{r.previewUrl=null,r.previewName=null,r.preview=!1;const t=angular.copy(r.url);r.setImage=(e=>{r.previewUrl=e,r.preview=!0,r.$apply()}),r.cancel=(()=>{r.previewUrl=null,r.previewName=null,r.preview=!1,r.url=void 0!==t?t:null,angular.element(a.find("input")).val("")}),r.processFile=(e=>{if(1!=e.files.length)return;var a=new FileReader;a.onload=function(e){r.setImage(e.target.result)};const[t]=e.files;a.readAsDataURL(t),r.previewName=t.name,r.url=t,r.$apply()}),r.$watch("url",e=>{void 0!==e&&null!==e||r.cancel()})}],restrict:"E",scope:{url:"="},templateUrl:"/templates/uploadFile.html"})),app.factory("configService",[()=>({title:"Enroute Rewards",keyword:{token:":taco:",singular:"taco",plural:"tacos"}})]);const ENDPOINT="/rewards/";app.factory("rewardsService",["$log","$http",(e,r)=>({get:e=>r.get(`/rewards//${e}`),getAll:()=>r.get("/rewards/all"),getImageUrl:e=>firebase.storage().ref().child(e).getDownloadURL(),remove:e=>r.delete(`/rewards/delete/${e}`),reward:e=>{return new function(e){Object.assign(this,e)}(e)},update:(a,t,l)=>{e.log("changes",l);const n=firebase.storage();if(t.key=a,l.indexOf("image")>-1){const e=`images/rewards/${Number(new Date)}-${t.image.name}`,a=n.ref().child(e);return new Promise(function(l,n){a.put(t.image).then(()=>{t.image=e,l(r.post("/rewards/update",t))}).catch(e=>{n(e)})})}return r.post("/rewards/update",t)}})]);